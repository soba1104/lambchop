#!/usr/bin/env ruby

require 'erb'

template = ERB.new(<<-EOS, 0, '%-')
#include <stdint.h>

static int vm_main(void *func, void *stack, uint64_t stacksize)
{
  uint64_t rip;
  uint64_t rax, rcx, rdx, rbx, rsp, rbp, rsi, rdi;
  uint64_t r8, r9, r10, r11, r12, r13, r14, r15;
  uint8_t rex, modrm;

  rip = (uint64_t)func;
  rbp = (uint64_t)stack;
  rsp = (uint64_t)stack;

  return 0;
}
EOS
puts template.result(binding)
